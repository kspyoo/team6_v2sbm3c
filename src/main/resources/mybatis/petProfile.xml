<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dev.mvc.petprofile.PetProfileDAOInter">
    <insert id="create" parameterType="dev.mvc.petprofile.PetProfileVO">
        INSERT INTO PETPROFILE(PETPROFILENO, OGFILENAME, SVFILENAME, SEQNO, UPLOADDATE, PETNO)
        VALUES (PETPROFILE_SEQ.nextval, #{ogFileName}, #{svFileName}, 0, sysdate, #{petNo})
    </insert>

    <!--  메인 이미지 조회(seqno로 먼저 정렬후 제일 처음에 있는 이미지를 메인이미지로 사용함. seqno를 지정 하지 않았거나 같은 순서로 되어있을 경우)  -->
    <select id="read_one" parameterType="int" resultType="dev.mvc.petprofile.PetProfileVO">
        -- rownum == 1 인 이미지를 메인 이미지로 사용
        select PETPROFILENO, OGFILENAME, SVFILENAME, SEQNO, UPLOADDATE, PETNO
        from (
                 -- rownum 생성
                 select PETPROFILENO, OGFILENAME, SVFILENAME, ROWNUM as SEQNO, UPLOADDATE, PETNO
                 from (
                          -- SEQNO 내림차순 정렬 -> PETPROFILENO 내림차순 정렬
                          select PETPROFILENO, OGFILENAME, SVFILENAME, SEQNO, UPLOADDATE, PETNO
                          from PETPROFILE
                          where PETNO = #{petNo}
                          order by SEQNO desc, PETPROFILENO desc
                      )
             )
        where SEQNO = 1
    </select>

    <select id="list" parameterType="int" resultType="dev.mvc.petprofile.PetProfileVO">
        select PETPROFILENO, OGFILENAME, SVFILENAME, SEQNO, UPLOADDATE, PETNO
        from (
                 select PETPROFILENO, OGFILENAME, SVFILENAME, ROWNUM as SEQNO, UPLOADDATE, PETNO
                 from (
                          select PETPROFILENO, OGFILENAME, SVFILENAME, SEQNO, UPLOADDATE, PETNO
                          from PETPROFILE
                          where PETNO = #{petNo}
                          order by SEQNO desc, PETPROFILENO desc
                      )
             )
    </select>
</mapper>